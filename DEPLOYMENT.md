# Deployment Guide for Booking System

## Prerequisites

1. **GitHub Repository**: Push your code to GitHub
2. **Render Account**: Sign up at [render.com](https://render.com)
3. **Email Configuration**: Gmail account with App Password
4. **Google OAuth**: Configure OAuth credentials for production

## Step 1: Prepare Environment Variables

Before deployment, you'll need these environment variables:

### Email Service
```
SMTP_USERNAME=your-email@gmail.com
SMTP_PASSWORD=your-app-password
FROM_EMAIL=your-email@gmail.com
FROM_NAME=Booking System
```

### Google OAuth
```
REACT_APP_GOOGLE_CLIENT_ID=your-google-client-id.apps.googleusercontent.com
```

## Step 2: Deploy on Render

### Option 1: Using render.yaml (Recommended)

1. **Push to GitHub**: Commit all changes and push to your GitHub repository
2. **Connect Repository**: In Render dashboard, click "New" â†’ "Blueprint"
3. **Import Blueprint**: Connect your GitHub repo and select `render.yaml`
4. **Configure Environment Variables**: Set the variables mentioned above
5. **Deploy**: Render will automatically deploy all services

### Option 2: Manual Deployment

Deploy services in this order:

1. **Database** (PostgreSQL)
   - Type: PostgreSQL
   - Name: `booking-system-db`
   - Plan: Free

2. **Backend Services**
   - **Backend API**
     - Type: Web Service
     - Runtime: Docker
     - Dockerfile path: `./backend/Dockerfile`
     - Build context: `./backend`
   
   - **CRM Service**
     - Type: Web Service
     - Runtime: Docker
     - Dockerfile path: `./crm_service/Dockerfile`
     - Build context: `./crm_service`
   
   - **Notification Service**
     - Type: Web Service
     - Runtime: Docker
     - Dockerfile path: `./notification_service/Dockerfile`
     - Build context: `./notification_service`
   
   - **Email Service**
     - Type: Web Service
     - Runtime: Docker
     - Dockerfile path: `./email_service/Dockerfile`
     - Build context: `./email_service`

3. **Frontend**
   - Type: Web Service
   - Runtime: Docker
   - Dockerfile path: `./frontend/Dockerfile`
   - Build context: `./frontend`

## Step 3: Configure Google OAuth for Production

1. **Google Cloud Console**: Go to [console.cloud.google.com](https://console.cloud.google.com)
2. **OAuth Consent Screen**: Configure your app
3. **Credentials**: Add your production domains:
   - Authorized JavaScript origins: `https://your-frontend-url.onrender.com`
   - Authorized redirect URIs: `https://your-frontend-url.onrender.com`

## Step 4: Environment Variables Configuration

### Backend Service
```
DATABASE_URL=<auto-generated-by-render>
JWT_SECRET_KEY=<auto-generated-by-render>
CRM_SERVICE_URL=https://booking-system-crm.onrender.com
NOTIFICATION_SERVICE_URL=https://booking-system-notification.onrender.com
EMAIL_SERVICE_URL=https://booking-system-email.onrender.com
BACKEND_SERVICE_TOKEN=<auto-generated-by-render>
FLASK_ENV=production
```

### Frontend Service
```
REACT_APP_API_URL=https://booking-system-backend.onrender.com
REACT_APP_NOTIFICATION_URL=https://booking-system-notification.onrender.com
REACT_APP_GOOGLE_CLIENT_ID=your-google-client-id.apps.googleusercontent.com
```

## Step 5: Post-Deployment

1. **Test Services**: Check all service URLs are accessible
2. **Database Migration**: Services will auto-create tables on first run
3. **Test Features**: 
   - User registration/login
   - Google OAuth
   - Session booking
   - Email notifications

## Troubleshooting

### Common Issues

1. **Service Won't Start**
   - Check logs in Render dashboard
   - Verify all environment variables are set
   - Check Dockerfile syntax

2. **Database Connection Issues**
   - Verify DATABASE_URL is correctly set
   - Check if database service is running

3. **Google OAuth Issues**
   - Verify REACT_APP_GOOGLE_CLIENT_ID is correct
   - Check authorized origins in Google Cloud Console

4. **Email Issues**
   - Verify SMTP credentials
   - Check if Gmail App Password is enabled

## Render Free Tier Limitations

- Services sleep after 15 minutes of inactivity
- Database storage: 1GB
- Build time: 500 minutes/month
- Services may take 30-60 seconds to wake up

## Production Considerations

For production use, consider:
- Upgrading to paid Render plans
- Using external database (AWS RDS, etc.)
- Setting up custom domain
- Implementing monitoring and logging
- Adding SSL certificates (handled by Render)

## Support

If you encounter issues:
1. Check Render service logs
2. Verify all environment variables
3. Test services individually
4. Check network connectivity between services
